let timer,Audioplayer;NProgress.configure({showSpinner:!1}),NProgress.configure({trickleSpeed:200}),history.scrollRestoration="manual";let csrf_token,editListeningSliderDebounceTimeOut,lessonQuestionCount=0,editListeningQuillArray=new Array,editListeningQuestionsArray=new Array,editListeningQuestionCount=0,safeToExit=!0;DisableDevtool.isSuspend=!1;const apiSubdomain="https://api.engboost.vn/";let editReadingSliderDebouncecTimeOut,editArticleQill,editReadingQuestionCount=0,editReadingQuillArray=new Array,editReadingQuestionsArray=new Array,editReadingPassageQuillArray=new Array,editReadingPassageArray=new Array,showingCheatingAlert=!1;const originalFetch=window.fetch;function setDarkMode(){document.getElementById("footer").classList.remove("bg-white"),document.documentElement.classList.add("dark-mode"),document.getElementById("default-navbar").classList.add("navbar-dark"),document.querySelector("#ui-navbar-not-logged-in-loginButton").classList.remove("btn-outline-dark"),document.querySelector("#ui-navbar-not-logged-in-loginButton").classList.add("btn-outline-white"),document.querySelector("#ui-navbar-not-logged-in-registerButton").classList.remove("btn-outline-dark"),document.querySelector("#ui-navbar-not-logged-in-registerButton").classList.add("btn-outline-white"),document.querySelectorAll(".ui-login-icons").forEach((e=>{e.style.color="white"}))}function setLightMode(){document.documentElement.classList.remove("dark-mode"),document.getElementById("footer").classList.add("bg-white"),document.getElementById("default-navbar").classList.remove("navbar-dark"),document.querySelector("#ui-navbar-not-logged-in-loginButton").classList.add("btn-outline-dark"),document.querySelector("#ui-navbar-not-logged-in-loginButton").classList.remove("btn-outline-white"),document.querySelector("#ui-navbar-not-logged-in-registerButton").classList.add("btn-outline-dark"),document.querySelector("#ui-navbar-not-logged-in-registerButton").classList.remove("btn-outline-white"),document.querySelectorAll(".ui-login-icons").forEach((e=>{e.style.color="#272c33"}))}async function performSaveDraftReading(e,t){document.getElementById("ui-edit-reading-syncStatusText").textContent="Đang lưu bản nháp",document.getElementById("ui-edit-reading-syncStatusIcon").textContent="sync",safeToExit=!1;const n=new Array;for(let e=0;e<editReadingPassageQuillArray.length;e++)n.push(DOMPurify.sanitize(editReadingPassageQuillArray[e].root.innerHTML));t.append("lessonId",e),t.append("lessonPassages",JSON.stringify(n)),t.append("lessonOneTime",document.querySelector("#ui-edit-reading-oneTimeAllowCheckbox").checked),t.append("saveSettings",JSON.stringify({saveType:"draft"})),t.append("csrf_token",csrf_token),await fetch(apiSubdomain+"edit/reading/publish",{method:"POST",body:t}),safeToExit=!0,document.getElementById("ui-edit-reading-syncStatusText").textContent="Đã lưu bản nháp",document.getElementById("ui-edit-reading-syncStatusIcon").textContent="done_all"}async function loadBlogPost(e){NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("blogId",e);const n=await fetch(apiSubdomain+"blog/details",{method:"POST",body:t});if(n.ok){const e=await n.json();document.title=e.informations.name,document.getElementById("ui-blog-post-blogTitle").textContent=e.informations.name,document.querySelector("#ui-blog-post-blogContentArea").innerHTML=e.informations.content}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("blog-post").forEach((e=>e.style.display="block")),await switchPages(),NProgress.done()}async function loadEditAccountPage(){NProgress.start(),await checkLoginStatus(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("account").forEach((e=>e.style.display="block")),await switchPages(),NProgress.done()}async function loadNewsManagerPage(){NProgress.start(),await checkLoginStatus(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("manage-quizzes").forEach((e=>e.style.display="block")),NProgress.done(),document.title="Quản Lý Thông Báo",document.querySelectorAll(".ui-manage-lessons-courseName").forEach((e=>e.textContent="Quản Lý Thông Báo")),document.querySelector("#ui-manage-lessons-skillList").style.display="none",document.querySelector("#ui-manage-lessons-createDropdownButton").style.display="none",await switchPages()}async function loadDictionaryDefinitionPage(e){NProgress.start(),await checkLoginStatus(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("dictionary").forEach((e=>e.style.display="block")),NProgress.done(),document.title="Từ điển",document.querySelector("#ui-dictionary-searchWord").textContent=e.toLowerCase();const t=new FormData;t.append("query",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"dictionary/search",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();document.querySelector("#ui-dictionary-wordClass").textContent=i.word_class,document.getElementById("ui-dictionary-britishPhoneticsAudio").src="https://api.dictionaryapi.dev/media/pronunciations/en/"+e.toLowerCase()+"-uk.mp3",await switchPages()}async function saveChangesEditArticle(e){const t=$("#ui-edit-article-addToCourseSelect").select2("data"),n=$("#ui-edit-article-addToSectionSelect").select2("data"),i=new FormData;i.append("articleId",e),i.append("articleName",document.querySelector("#ui-edit-article-nameField").value.trim()),i.append("articleContent",editArticleQill.root.innerHTML),i.append("articleAllowComments",document.querySelector("#ui-edit-article-allowCommentCheckbox").checked),i.append("articleLocked",document.querySelector("#ui-edit-article-lockArticleCheckbox").checked),i.append("articleCourses",JSON.stringify(t.map((e=>parseInt(e.id,10))))),i.append("articleSections",JSON.stringify(n.map((e=>parseInt(e.id,10))))),i.append("csrf_token",csrf_token);const o=await fetch(apiSubdomain+"edit/article/publish",{body:i,method:"POST"});if(!o.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}if("success"===(await o.json()).message)document.querySelector("#ui-edit-article-syncStatusText").textContent="Đã lưu bản nháp";else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}}function editArticleQillTextChangeHandle(){editArticleQillTextChangeHandle.timeoutId&&clearTimeout(editArticleQillTextChangeHandle.timeoutId),document.querySelector("#ui-edit-article-syncStatusText").textContent="Đang lưu bản nháp",editArticleQillTextChangeHandle.timeoutId=setTimeout((async()=>{saveChangesEditArticle(window.location.pathname.split("/").filter(Boolean).pop())}),1e3)}async function loadEditArticlePage(e){await NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("articleId",e),t.append("action","editing"),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/article/details",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();if("success"!==i.message){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}document.title=i.informations.articleName,document.querySelectorAll(".ui-edit-article-articleName").forEach((e=>{e.textContent=i.informations.articleName})),document.querySelector("#ui-edit-article-nameField").value=i.informations.articleName,document.getElementById("ui-edit-article-addToCourseSelect").replaceChildren(),editArticleQill=await new Quill("#soan-bai-giang-field",{theme:"snow",modules:{toolbar:[["bold","italic","underline","strike","blockquote","code-block","link","image"],[{header:1},{header:2},{header:3},{header:4}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},placeholder:"Soạn nội dung câu hỏi tại đây..."});const o=i.informations.articleContent[0];editArticleQill.clipboard.dangerouslyPasteHTML(o);const a=new FormData;a.append("csrf_token",csrf_token);const s=await fetch(apiSubdomain+"edit/article/courses",{method:"POST",body:a});if(!s.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const r=await s.json();if("success"===r.message){for(x=0;x<r.courses.length;x++){const e=document.importNode(document.getElementById("ui-select2-option-element").content,!0);e.querySelector("[data-id='option']").textContent=r.courses[x].name,e.querySelector("[data-id='option']").value=r.courses[x].id,document.querySelector("#ui-edit-article-addToCourseSelect").appendChild(e)}editArticleQill.on("text-change",editArticleQillTextChangeHandle),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("edit-article").forEach((e=>e.style.display="block")),document.querySelector("#ui-edit-article-addToCourseSelect").value=i.informations.articleCourses,await switchPages(),await NProgress.done()}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}}async function loadPrivacyPolicyPage(){NProgress.start(),await checkLoginStatus(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("privacy-policy").forEach((e=>e.style.display="block")),switchPages(),NProgress.done()}async function performSaveDraftListening(e,t){t.append("lessonId",e),t.append("lessonOneTime",document.querySelector("#ui-edit-listening-oneTimeAllowCheckbox").checked),t.append("saveSettings",JSON.stringify({saveType:"draft"})),t.append("csrf_token",csrf_token),await fetch(apiSubdomain+"edit/listening/publish",{method:"POST",body:t}),safeToExit=!0,document.getElementById("ui-edit-listening-syncStatusText").textContent="Đã lưu bản nháp",document.getElementById("ui-edit-listening-syncStatusIcon").textContent="done_all"}async function loadEditNewsPage(e){const t=new FormData;t.append("newsId",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/news/details",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();document.title=i.informations.newsName}async function loadEditReadingPage(e){$("#ui-edit-reading-timeLimitSlider").ionRangeSlider({min:1,max:60,from:0,grid:!0,postfix:" phút",disable:!0,type:"single",onFinish:async function(){clearInterval(editListeningSliderDebounceTimeOut),editListeningSliderDebounceTimeOut=setTimeout((async()=>{await checkLoginStatus();const e=new FormData;e.append("saveChanges","{}"),e.append("lessonTime",parseInt(document.getElementById("ui-edit-listening-timeLimitSlider").value)),await performSaveDraftReading(window.location.pathname.split("/").filter(Boolean).pop(),e)}),1e3)}});editReadingQuestionCount=0,editReadingQuestionsArray=new Array,editReadingQuillArray=new Array,NProgress.start();const t=new FormData;t.append("lessonId",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/reading/details",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();document.getElementById("ui-edit-reading-questionContainerRoot").replaceChildren();for(let e=0;e<i.informations.lessonParts;e++){const t=document.importNode(document.getElementById("edit-reading-passageEditor").content,!0);t.querySelector('[data-id="passage-editor-field"]').id="edit-reading-passage-quill-part"+[e+1],t.querySelector('[data-id="passage-editor-title"]').textContent="Soạn bài đọc phần "+[e+1],document.querySelector("#ui-edit-reading-questionContainerRoot").appendChild(t),editReadingPassageQuillArray.push(new Quill("#edit-reading-passage-quill-part"+[e+1],{theme:"snow",placeholder:"Soạn nội dung bài đọc tại đây..."}));const n=document.createElement("div");n.className="page-separator";const o=document.createElement("div");o.className="page-separator__text",o.textContent="Câu hỏi phần "+[e+1],n.appendChild(o),document.querySelector("#ui-edit-reading-questionContainerRoot").appendChild(n);const a=document.createElement("div");if(a.id="ui-edit-reading-questionsContainerPart"+[e+1],document.querySelector("#ui-edit-reading-questionContainerRoot").appendChild(a),0===i.questions.length){const t=document.createElement("div"),n=document.createElement("h5"),i=document.createElement("center");i.id="placeholder_reading_part"+[e+1],i.style.marginBottom="40px",t.style.backgroundImage='url("https://raw.githubusercontent.com/ducanhdang34/storage/refs/heads/main/images/empty.2da6bd9c.png")',t.style.backgroundRepeat="no-repeat",t.style.height="200px",t.style.width="169px",t.style.backgroundSize="contain",n.textContent="Bạn chưa thêm câu hỏi nào",i.appendChild(t),i.appendChild(document.createElement("br")),i.appendChild(n),document.querySelector("#ui-edit-reading-questionContainerRoot").appendChild(i)}else{const t=document.createElement("div");t.id="ui-create-readingContainer-Part"+[e+1],document.getElementById("ui-edit-reading-questionContainerRoot").appendChild(t);const n=document.importNode(document.querySelector("#ui-edit-lesson-questionCard").content,!0);n.querySelector('[data-id="question-count"]').textContent="Câu hỏi ",document.querySelector("#ui-create-readingContainer-Part"+[e+1]).appendChild(n),editReadingQuestionCount+=1}const s=document.importNode(document.querySelector("#ui-edit-lesson-questionEditor").content,!0);s.querySelector('[data-id="question-description-field"]').id="ui-edit-reading-questionDescriptionFieldPart"+[e+1],s.querySelector('[data-id="question-category-selector"]').id=`ui-edit-reading-questionCategorySelectorPart${[e+1]}`,s.querySelector('[data-id="multiple-choice-editor"]').id=`ui-edit-reading-multipleChoiceEditorPart${[e+1]}`,s.querySelector('[data-id="multiple-choice-answer-container"]').id=`ui-edit-reading-multipleChoiceAnswerContainerPart${[e+1]}`,s.querySelector('[data-id="multiple-choice-answer-input"]').classList.add("ui-edit-reading-multipleChoiceAnswerPart"+[e+1]),s.querySelector('[data-id="multiple-choice-answer-input"]').classList.add("form-control"),s.querySelector('[data-id="correct-answer-select"]').id=`ui-edit-reading-correctAnswerSelectPart${[e+1]}`,s.querySelector('[data-id="short-answer-editor"]').id=`ui-edit-reading-shortAnswerEditorPart${[e+1]}`,s.querySelector('[data-id="short-answer-container"]').id=`ui-edit-reading-shortAnswerContainerPart${[e+1]}`,s.querySelector('[data-id="short-answer-container"]').classList.add("ui-edit-reading-shortAnswerPart"+[e+1]),s.querySelector('[data-id="short-answer-input"]').classList.add("ui-edit-reading-shortAnswerAnswerPart"+[e+1]),s.querySelector('[data-id="short-answer-input"]').classList.add("form-control"),s.querySelector('[data-id="add-new-question"]').classList.add("ui-edit-reading-addNewQuestionPart"+[e+1]),s.querySelector('[data-id="add-new-part"]').classList.add("ui-edit-reading-addNewPartAfterPart"+[e+1]),s.querySelector('[data-id="delete-current-part"]').classList.add("ui-edit-reading-deleteCurrentPart"+[e+1]),s.querySelector('[data-id="delete-current-part"]').textContent="Xóa phần "+[e+1],document.getElementById("ui-edit-reading-questionContainerRoot").append(s),editReadingQuillArray.push(new Quill("#ui-edit-reading-questionDescriptionFieldPart"+[e+1],{theme:"snow",placeholder:"Soạn nội dung câu hỏi tại đây..."}))}document.querySelectorAll(".ui-edit-reading-lessonName").forEach((e=>e.textContent=i.informations.lessonName)),document.querySelectorAll(".ui-edit-reading-lessonName").forEach((t=>t.href="/edit/"+e)),document.title=i.informations.lessonName,document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("edit-reading").forEach((e=>e.style.display="block")),await switchPages(),NProgress.done()}async function loadEditListeningPage(e){function t(){const e=new FormData;e.append("saveChanges",JSON.stringify({})),$("#ui-edit-listening-noLimitTimeCheckbox").is(":checked")?e.append("lessonTime",0):e.append("lessonTime",document.getElementById("ui-edit-listening-timeLimitSlider").value),document.getElementById("ui-edit-listening-syncStatusText").textContent="Đang lưu bản nháp",document.getElementById("ui-edit-listening-syncStatusIcon").textContent="sync",performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),e),a()}editListeningQuestionCount=0,editListeningQuestionsArray=new Array,editListeningQuillArray=new Array,$("#ui-edit-listening-noLimitTimeCheckbox").off("change",t),NProgress.start();const n=new FormData;n.append("lessonId",e),n.append("csrf_token",csrf_token);const i=await fetch(apiSubdomain+"edit/listening/details",{method:"POST",body:n});if(!i.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const o=$("#ui-edit-listening-timeLimitSlider").ionRangeSlider({min:1,max:60,from:0,grid:!0,postfix:" phút",disable:!0,type:"single",onFinish:async function(){document.getElementById("ui-edit-listening-syncStatusText").textContent="Đang lưu bản nháp",document.getElementById("ui-edit-listening-syncStatusIcon").textContent="sync",clearInterval(editListeningSliderDebounceTimeOut),editListeningSliderDebounceTimeOut=setTimeout((async()=>{await checkLoginStatus();const e=new FormData;e.append("saveChanges","{}"),e.append("lessonTime",parseInt(document.getElementById("ui-edit-listening-timeLimitSlider").value)),await performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),e)}),1e3)}}).data("ionRangeSlider");function a(){$("#ui-edit-listening-noLimitTimeCheckbox").is(":checked")?o.update({disable:!0}):o.update({disable:!1})}a(),$("#ui-edit-listening-noLimitTimeCheckbox").on("change",t);const s=await i.json();document.title=s.informations.lessonName,document.querySelector("#ui-edit-listening-lessonNameTextField").value=s.informations.lessonName,s.informations.lessonSettings.timeLimit>0?(o.update({from:s.informations.lessonSettings.timeLimit}),document.getElementById("ui-edit-listening-noLimitTimeCheckbox").checked=!1,t()):(document.getElementById("ui-edit-listening-noLimitTimeCheckbox").checked=!0,o.update({from:1}),t()),document.getElementById("ui-edit-listening-questionContainerRoot").innerHTML="";for(let e=0;e<s.courses.length;e++){const t={id:s.courses[e].id,text:s.courses[e].name},n=new Option(t.text,t.id,!1,!1);$("#ui-edit-listening-chooseCourseSelect").append(n).trigger("change")}document.querySelector("#ui-edit-listening-chooseCourseSelect").value=s.informations.lessonCourses;for(let e=0;e<s.sections.length;e++){const t={id:s.sections[e].id,text:s.sections[e].name},n=new Option(t.text,t.id,!1,!1);$("#ui-edit-listening-chooseSectionSelect").append(n).trigger("change")}null!==s.informations.lessonSections&&(document.querySelector("#ui-edit-listening-chooseSectionSelect").value=s.informations.lessonSections);for(let t=0;t<s.informations.lessonParts;t++){document.querySelector("#ui-edit-listening-questionContainerRoot").insertAdjacentHTML("beforeend",`<div class="page-separator"><div class="page-separator__text">Câu hỏi phần ${[t+1]}</div></div><ul class="mb-40pt" style="padding: 0" id="ui-manage-lessons-questionsContainerPart${[t+1]}"></ul>`),s.questions.length>0?s.questions.forEach(((n,i)=>{if(0===n.type){const o=Array.from({length:26},((e,t)=>String.fromCharCode(65+t)));let a="";n.options=JSON.parse(n.options);for(let e=0;e<n.options.length;e++)a+=`${o[e]}. ${n.options[e]}<br>`;const s={id:i+1,question:n.question,part:n.part,type:n.type,lesson_id:e,answer:n.answer,options:n.options};let r="";editListeningQuestionsArray.push(s),JSON.parse(n.answer).forEach((e=>{const t=e-1,i=String.fromCharCode(65+t);r+=i+". "+n.options[t]}));const l=document.importNode(document.getElementById("ui-edit-lesson-questionCard").content,!0);l.querySelector('[data-id="question-count"]').textContent="Câu hỏi "+[i+1],l.querySelector('[data-id="question-content"]').innerHTML=n.question+a,l.querySelector('[data-id="div-collapse"]').id=`collapse${i+1}`,l.querySelector('[data-id="div-collapse"]').innerHTML=r,l.querySelector('[data-id="course-toc"]').id="course-toc-"+[i+1],l.querySelector('[data-id="course-acc"]').setAttribute("data-target","#course-toc-"+[i+1]),l.querySelector('[data-id="course-acc"]').setAttribute("data-parent","#ui-edit-listening-accordion-"+[i+1]),l.querySelector('[data-id="js-acc"]').id="ui-edit-listening-accordion-"+[i+1],document.querySelector("#ui-manage-lessons-questionsContainerPart"+[t+1]).appendChild(l)}else if(2===n.type){let o="";n.answer=JSON.parse(n.answer);for(let e=0;e<n.answer.length-1;e++)o+=n.answer[e]+"<br>";const a={id:i+1,question:n.question,part:n.part,type:n.type,lesson_id:e,answer:n.answer,options:null};editListeningQuestionsArray.push(a);const s=document.importNode(document.getElementById("ui-edit-lesson-questionCard").content,!0);s.querySelector('[data-id="question-count"]').textContent="Câu hỏi "+[i+1],s.querySelector('[data-id="question-content"]').innerHTML="<div class='nopadding'>"+n.question+"</div>",s.querySelector('[data-id="div-collapse"]').id=`collapse${i}`,s.querySelector('[data-id="div-collapse"]').innerHTML=o,document.querySelector("#ui-manage-lessons-questionsContainerPart"+[t+1]).appendChild(s)}editListeningQuestionCount+=1})):document.querySelector("#ui-manage-lessons-questionsContainerPart"+[t+1]).innerHTML="<center><div style='background-image: url(\"https://raw.githubusercontent.com/ducanhdang34/storage/refs/heads/main/images/empty.2da6bd9c.png\"); background-repeat: no-repeat; height: 200px; width: 169px; background-size: contain'></div><br><h5>Bạn chưa thêm câu hỏi nào</h5></center>";const n=document.importNode(document.getElementById("ui-edit-lesson-questionEditor").content,!0);n.querySelector('[data-id="question-description-field"]').id=`ui-edit-listening-questionDescriptionFieldPart${[t+1]}`,n.querySelector('[data-id="question-category-selector"]').id=`ui-edit-listening-questionCategorySelectorPart${[t+1]}`,n.querySelector('[data-id="multiple-choice-editor"]').id=`ui-edit-listening-multipleChoiceEditorPart${[t+1]}`,n.querySelector('[data-id="multiple-choice-answer-container"]').id=`ui-edit-listening-multipleChoiceAnswerContainerPart${[t+1]}`,n.querySelector('[data-id="multiple-choice-answer-input"]').classList.add("ui-edit-listening-multipleChoiceAnswerPart"+[t+1]),n.querySelector('[data-id="multiple-choice-answer-input"]').classList.add("form-control"),n.querySelector('[data-id="correct-answer-select"]').id=`ui-edit-listening-correctAnswerSelectPart${[t+1]}`,n.querySelector('[data-id="short-answer-editor"]').id=`ui-edit-listening-shortAnswerEditorPart${[t+1]}`,n.querySelector('[data-id="short-answer-container"]').id=`ui-edit-listening-shortAnswerContainerPart${[t+1]}`,n.querySelector('[data-id="short-answer-container"]').classList.add("ui-edit-listening-shortAnswerPart"+[t+1]),n.querySelector('[data-id="short-answer-input"]').classList.add("ui-edit-listening-shortAnswerAnswerPart"+[t+1]),n.querySelector('[data-id="short-answer-input"]').classList.add("form-control"),n.querySelector('[data-id="add-new-question"]').classList.add("ui-edit-listening-addNewQuestionPart"+[t+1]),n.querySelector('[data-id="add-new-part"]').classList.add("ui-edit-listening-addNewPartAfterPart"+[t+1]),n.querySelector('[data-id="delete-current-part"]').classList.add("ui-edit-listening-deleteCurrentPart"+[t+1]),n.querySelector('[data-id="delete-current-part"]').textContent="Xóa phần "+[t+1],document.querySelector("#ui-edit-listening-questionContainerRoot").appendChild(n),editListeningQuillArray.push(new Quill("#ui-edit-listening-questionDescriptionFieldPart"+[t+1],{theme:"snow",placeholder:"Soạn nội dung câu hỏi tại đây..."}))}if(null!==s.informations.lessonAudios)for(let e=0;e<JSON.parse(s.informations.lessonAudios).length;e++)document.querySelector("#ui-edit-listening-choosenAudioFilePart"+[e+1]).textContent=JSON.parse(s.informations.lessonAudios)[0].split("/").pop();document.getElementById("ui-edit-listening-lessonName").textContent=s.informations.lessonName,document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("edit-listening").forEach((e=>e.style.display="block")),await switchPages(),NProgress.done()}async function performDeleteQuestion(e){NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("actionDelete",!0),t.append("saveSettings",JSON.stringify({saveType:"draft"})),t.append("saveChanges",JSON.stringify({})),t.append("questionId",e),t.append("lessonId",window.location.pathname.split("/").filter(Boolean).pop()),t.append("csrf_token",csrf_token),await fetch(apiSubdomain+"edit/listening/publish",{body:t,method:"POST"}),NProgress.done()}async function performLogout(){await checkLoginStatus();const e=new FormData;e.append("csrf_token",csrf_token);if((await fetch(apiSubdomain+"auth/logout",{method:"POST",body:e})).ok){loadLoginPage(),window.history.pushState({},"","/login");Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Đăng xuất thành công"})}}function startSmoothTimer(e){let t=document.querySelector(".ui-lesson-details-timer"),n=document.querySelector("#ui-lesson-details-timertext");if(!t||!n)return;let i=Date.now()+e+1e3;t.style.transition=`width ${e}ms linear`,t.style.width="0%",timer=setInterval((()=>{let e=Math.max(0,i-Date.now()),t=String(Math.floor(e/6e4)).padStart(2,"0"),o=String(Math.floor(e%6e4/1e3)).padStart(2,"0");n.textContent=`Thời gian còn lại: ${t}:${o}`,e<=0&&stopTimer()}),1e3)}async function submitLessonAction(e,t){e.disabled=!0,e.classList.add("is-loading"),await checkLoginStatus();const n=new Array,i=new FormData;i.append("lesson_id",t),i.append("csrf_token",csrf_token);for(let e=1;e<=lessonQuestionCount;e++){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let i=!1;for(let o=0;o<t.length;o++){const a=`ui-lesson-details-question${e}-option${t[o]}`,s=document.getElementById(a);if(s&&"check"===s.textContent){n.push(o+1),i=!0;break}}i||n.push(0)}i.append("userAnswer",JSON.stringify(n));const o=await fetch(apiSubdomain+"lessons/scoring",{method:"POST",body:i});if(!o.ok)return void alert("Something went wrong...");const a=await o.json();if(!a.success)return void alert("Something went wrong...");a.answerState.forEach(((e,t)=>{!0===e?(document.getElementById("ui-lesson-details-question"+(t+1)).insertAdjacentHTML("beforebegin",'<i class="material-icons" style="margin-right: 1rem" id="ui-lesson-details-answerStatus'+(t+1)+'">check</i>'),document.getElementById("ui-lesson-details-question"+(t+1)).style.color="rgb(30,142,62)",document.getElementById("ui-lesson-details-answerStatus"+(t+1)).style.color="rgb(30,142,62)"):(document.getElementById("ui-lesson-details-question"+(t+1)).insertAdjacentHTML("beforebegin",'<i class="material-icons" style="margin-right: 1rem" id="ui-lesson-details-answerStatus'+(t+1)+'">close</i>'),document.getElementById("ui-lesson-details-question"+(t+1)).style.color="rgb(217,48,37)",document.getElementById("ui-lesson-details-answerStatus"+(t+1)).style.color="rgb(217,48,37)")})),clearInterval(timer),document.querySelector(".ui-lesson-details-timer").style.transition="none";Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Bài làm của bạn đã được ghi nhận"}),window.scrollTo({top:0,behavior:"smooth"});const s=new Date,r=`${String(s.getDate()).padStart(2,"0")} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()]} ${s.getFullYear()}`;document.getElementById("ui-lesson-details-timertext").textContent="Bạn làm đúng "+a.score+"/"+a.answerState.length+" câu",document.querySelector("#ui-lesson-details-submitedOn").textContent="Đã nộp bài vào "+r,document.querySelector("#ui-lesson-details-submitedOn").style.display="block",e.classList.remove("is-loading"),document.querySelector("#ui-lesson-details-restartQuiz").style.display="inline-flex",document.querySelector("#ui-lesson-details-restartQuiz").href="/lesson/"+t;const l=new FormData;l.append("csrf_token",csrf_token),l.append("lessonId",t),l.append("userAnswer",JSON.stringify(n)),l.append("answerState",JSON.stringify(a.answerState)),l.append("correctAnswer",JSON.stringify(a.answers));await fetch(apiSubdomain+"history/record",{method:"POST",body:l})}async function addToFavourite(e,t){if(e)if("favorite_border"===e.textContent){e.textContent="favorite";const n=new FormData;n.append("item_id",t);const i=await fetch(apiSubdomain+"favorites/favorite",{method:"POST",body:n});if(!i.ok)return void alert("Something went wrong...");if(!(await i.json()).success)return void alert("Something went wrong...")}else{e.textContent="favorite_border";const n=new FormData;n.append("item_id",t);const i=await fetch(apiSubdomain+"favorites/unfavorite",{method:"POST",body:n});if(!i.ok)return void alert("Something went wrong...");if(!(await i.json()).success)return void alert("Something went wrong...")}}window.fetch=async function(e,t){t=t||{};return("string"==typeof e?e:e.url).startsWith("https://api.engboost.vn")&&(t.credentials="include"),originalFetch(e,t)},window.addEventListener("beforeunload",(function(e){safeToExit||e.preventDefault()})),document.body.addEventListener("click",(e=>{const t=e.target.closest("a.load");if(!t)return;e.preventDefault();const n=t.getAttribute("href");if(window.history.pushState({},"",n),NProgress.start(),n.includes("login"))loadLoginPage();else if("/"===n)loadHomePage();else if(n.includes("logout"))performLogout();else if(n.includes("dashboard"))loadDashboard(n.split("/").filter(Boolean).pop());else if(n.includes("lesson"))loadLesson(n.split("/").filter(Boolean).pop());else if(n.includes("register"))loadRegisterPage();else if(n.includes("/edit/")){!async function(){await checkLoginStatus();const e=new FormData;e.append("lessonId",n.split("/").filter(Boolean).pop()),e.append("csrf_token",csrf_token);const t=await fetch(apiSubdomain+"edit/type",{method:"POST",body:e});if(t.ok){const e=await t.json();0==e.skill?loadEditListeningPage(n.split("/").filter(Boolean).pop()):2==e.skill&&loadEditReadingPage(n.split("/").filter(Boolean).pop())}}()}else n.includes("/quizzes/")?loadManageLessonsPage(n.split("/").filter(Boolean).pop()):n.includes("privacy-policy")?loadPrivacyPolicyPage():n.includes("account")?loadEditAccountPage():n.includes("/blog/")&&"blog"!=n.split("/").filter(Boolean).pop()&&loadBlogPost(n.split("/").filter(Boolean).pop())})),addEventListener("popstate",(()=>{const e=window.location.pathname.split("/").filter(Boolean).pop()||"";if(""===e||"/"===e)loadHomePage();else if("login"===e)loadLoginPage();else if("register"===e)loadRegisterPage();else if(window.location.pathname.includes("/dashboard/"))loadDashboard(e);else if(window.location.pathname.includes("/lesson/"))loadLesson(e);else if(window.location.pathname.includes("/edit/")){!async function(){await checkLoginStatus();const t=new FormData;t.append("lessonId",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/type",{method:"POST",body:t});if(n.ok){const t=await n.json();0==t.skill?loadEditListeningPage(e):2==t.skill&&loadEditReadingPage(e)}}()}else window.location.pathname.includes("/quizzes/")?loadManageLessonsPage(e):window.location.pathname.includes("privacy-policy")?loadPrivacyPolicyPage():window.location.pathname.includes("account")?loadEditAccountPage():window.location.pathname.includes("/blog/")&&"blog"!=e&&loadBlogPost(e)})),window.addEventListener("load",(()=>{const e=window.location.pathname.split("/").filter(Boolean).pop()||"";if(""===e||"/"===e)loadHomePage();else if("login"===e)loadLoginPage();else if("register"===e)loadRegisterPage();else if("logout"===e)performLogout();else if(window.location.pathname.includes("/dashboard/"))loadDashboard(e);else if(window.location.pathname.includes("/lesson/"))loadLesson(e);else if(window.location.pathname.includes("/edit/")){!async function(){await checkLoginStatus();const t=new FormData;t.append("lessonId",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/type",{method:"POST",body:t});if(n.ok){const t=await n.json();0==t.skill?loadEditListeningPage(e):5==t.skill?loadEditArticlePage(e):2==t.skill&&loadEditReadingPage(e)}}()}else window.location.pathname.includes("/quizzes/")?loadManageLessonsPage(e):window.location.pathname.includes("privacy-policy")?loadPrivacyPolicyPage():window.location.pathname.includes("account")?loadEditAccountPage():window.location.pathname.includes("/blog/")&&"blog"!==e?loadBlogPost(e):window.location.pathname.includes("news/manage")?loadNewsManagerPage():window.location.pathname.includes("/dictionary/")&&loadDictionaryDefinitionPage(e)})),document.addEventListener("change",(function(e){if("SELECT"===e.target.tagName&&e.target.id.startsWith("ui-edit-listening-questionCategorySelectorPart")){const t=e.target.id.replace(/[^0-9]/g,"");document.getElementById("ui-edit-listening-multipleChoiceEditorPart"+t).style.display="none",document.querySelector("#ui-edit-listening-shortAnswerEditorPart"+t).style.display="none",2==e.target.value?document.querySelector("#ui-edit-listening-shortAnswerEditorPart"+t).style.display="block":0==e.target.value&&(document.getElementById("ui-edit-listening-multipleChoiceEditorPart"+t).style.display="block")}})),document.addEventListener("click",(async e=>{if(e.target&&e.target.classList.contains("ui-edit-listening-deleteMultipleChoiceAnswer")){e.preventDefault();const t=e.target.parentNode;t.parentNode.removeChild(t)}else if(e.target&&e.target.classList.contains("ui-edit-listening-addNewPartAfterPart1"))e.preventDefault(),Swal.fire({title:"Bạn chắc chắn chứ?",text:"Bạn có chắn chắn muốn thêm phần mới? Hành động này không thể hoàn tác được.",icon:"question",showCancelButton:!0,confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Có, tôi chắc chắn",cancelButtonText:"Không, hủy bỏ",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}}).then((e=>{e.isConfirmed&&Swal.fire({title:"Đã thêm phần mới!",confirmButtonColor:"#5567ff",confirmButtonText:"Đóng",text:"Bạn đã thêm phần mới vào bài tập này.",icon:"success",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}})}));else if(e.target&&e.target.classList.contains("ui-dropdown-activateCourseButton"))e.preventDefault(),Swal.fire({title:"Kích hoạt khóa học",input:"text",icon:"info",confirmButtonColor:"#5567ff",showCancelButton:!0,confirmButtonText:"Kích hoạt ngay",cancelButtonText:"Đóng",showLoaderOnConfirm:!0,inputPlaceholder:"Nhập mã kích hoạt tại đây...",customClass:{input:"sweetAlertInput form-control",confirmButton:"swalConformButton",cancelButton:"swalCancelButton"},preConfirm:async e=>{const t=new FormData;t.append("activationCode",e),t.append("csrf_token",csrf_token);try{const e="/apis/course/activate",n=await fetch(e,{method:"POST",body:t});if(!n.ok)return Swal.showValidationMessage("Lỗi hệ thống");{const e=await n.json();if("failed"===e.message)return Swal.showValidationMessage(e.reason)}}catch(e){Swal.showValidationMessage(`Request failed: ${e}`)}},allowOutsideClick:()=>!Swal.isLoading()}).then((e=>{e.isConfirmed&&Swal.fire({title:"Đã kích hoạt thành công!",confirmButtonColor:"#5567ff",confirmButtonText:"Đóng",text:"Cảm ơn bạn đã tin tưởng Tiếng Anh cô Trung Thảo. Chúc bạn có một ngày thật vui vẻ.",icon:"success",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}})}));else if(e.target&&e.target.classList.contains("ui-edit-listening-deleteLessonButton"))e.preventDefault(),Swal.fire({title:"Bạn chắc chắn chứ?",text:"Bạn có chắn chắn muốn xóa bài tập này? Hành động này không thể hoàn tác được.",icon:"question",showCancelButton:!0,confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Có, tôi chắc chắn",cancelButtonText:"Không, đừng xóa",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}}).then((e=>{e.isConfirmed&&Swal.fire({title:"Đã xóa bài tập!",confirmButtonColor:"#5567ff",confirmButtonText:"Đã hiểu",text:"Bài tập này đã được xóa khỏi hệ thống.",icon:"success",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}})}));else if(e.target&&e.target.className.startsWith("btn btn-outline-primary ui-edit-listening-addNewQuestionPart")){e.preventDefault();const t=e.target.className.match(/\d+/)[0];if("<p><br></p>"==editListeningQuillArray[t-1].container.firstChild.innerHTML.trim()){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn chưa nhập nội dung câu hỏi"})}if(0==document.querySelector("#ui-edit-listening-questionCategorySelectorPart"+t).value){if([...document.querySelectorAll(".ui-edit-listening-multipleChoiceAnswerPart"+t)].some((e=>""===e.value))){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn có một câu trả lời trống"})}e.target.disabled=!0,e.target.classList.add("is-loading"),NProgress.start(),await checkLoginStatus();const n=new Array;document.querySelectorAll('input[class^="ui-edit-listening-multipleChoiceAnswerPart'+t+'"]').forEach((e=>{n.push(e.value)}));const i=new Array;i.push(parseInt(document.getElementById("ui-edit-listening-correctAnswerSelectPart"+t).value));const o={id:editListeningQuestionCount+=1,question:editListeningQuillArray[t-1].root.innerHTML.trim(),part:t,type:document.getElementById("ui-edit-listening-questionCategorySelectorPart"+t).value,lesson_id:window.location.pathname.split("/").filter(Boolean).pop(),answer:i,options:n};editListeningQuestionsArray.push(o);let a="";const s=Array.from({length:26},((e,t)=>String.fromCharCode(65+t)));for(let e=1;e<=n.length;e++)a+=s[e-1]+". "+n[e-1]+"<br>";const r=document.importNode(document.getElementById("ui-edit-lesson-questionCard").content,!0);r.querySelector('[data-id="question-count"]').textContent="Câu hỏi "+editListeningQuestionCount,r.querySelector('[data-id="question-content"]').innerHTML=editListeningQuillArray[t-1].root.innerHTML+a,r.querySelector('[data-id="div-collapse"]').id=`collapse${editListeningQuestionCount}`,r.querySelector('[data-id="div-collapse"]').innerHTML=n[parseInt(i[0])-1],r.querySelector('[data-id="course-toc"]').id="course-toc-"+editListeningQuestionCount,r.querySelector('[data-id="course-acc"]').setAttribute("data-target","#course-toc-"+editListeningQuestionCount),r.querySelector('[data-id="course-acc"]').setAttribute("data-parent","#ui-edit-listening-accordion-"+editListeningQuestionCount),r.querySelector('[data-id="js-acc"]').id="ui-edit-listening-accordion-"+editListeningQuestionCount,document.querySelector("#ui-manage-lessons-questionsContainerPart"+t).appendChild(r),editListeningQuillArray[t-1].setText("");let l=document.getElementById(`ui-edit-listening-multipleChoiceAnswerContainerPart${t}`)?.firstElementChild?.nextElementSibling;for(;l;){const e=l.nextElementSibling;l.parentNode.removeChild(l),l=e}const d=new FormData;d.append("saveChanges",JSON.stringify(o)),await performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),d),NProgress.done(),e.target.disabled=!1,e.target.classList.remove("is-loading"),document.querySelector("#ui-edit-listening-correctAnswerSelectPart"+t).querySelectorAll("option").forEach((e=>{"A"!==e.textContent&&document.getElementById("ui-edit-listening-correctAnswerSelectPart"+t).removeChild(e)})),document.querySelectorAll('input[class^="ui-edit-listening-multipleChoiceAnswerPart'+t+'"]').forEach((e=>{e.value=""}));Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Bạn đã thêm câu hỏi mới"})}else if(2==document.querySelector("#ui-edit-listening-questionCategorySelectorPart"+t).value){if([...document.querySelectorAll(".ui-edit-listening-shortAnswerAnswerPart"+t)].some((e=>""===e.value))){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn có một câu trả lời trống"})}e.target.disabled=!0,e.target.classList.add("is-loading"),NProgress.start(),await checkLoginStatus();const n=new Array;if(document.querySelectorAll('input[class^="ui-edit-listening-shortAnswerAnswerPart'+t+'"]').forEach((e=>{n.push(e.value)})),document.querySelector("#ui-edit-listening-ignoreCaseSensitive").checked){const e={caseSensitive:!1};n.push(e)}else{const e={caseSensitive:!0};n.push(e)}const i={id:editListeningQuestionCount+=1,question:editListeningQuillArray[t-1].container.firstChild.innerHTML.trim(),part:t,type:document.getElementById("ui-edit-listening-questionCategorySelectorPart"+t).value,lesson_id:window.location.pathname.split("/").filter(Boolean).pop(),answer:n,options:null};editListeningQuestionsArray.push(i);let o="";for(let e=1;e<n.length;e++)o+=n[e-1]+"<br>";const a=document.importNode(document.getElementById("ui-edit-lesson-questionCard").content,!0);a.querySelector('[data-id="question-count"]').textContent="Câu hỏi "+editListeningQuestionCount,a.querySelector('[data-id="question-content"]').innerHTML="<div class='nopadding'>"+editListeningQuillArray[t-1].container.firstChild.innerHTML.trim()+"</div>",a.querySelector('[data-id="div-collapse"]').id=`collapse${editListeningQuestionCount}`,a.querySelector('[data-id="div-collapse"]').innerHTML=o,document.querySelector("#ui-manage-lessons-questionsContainerPart"+t).appendChild(a),editListeningQuillArray[t-1].setText("");let s=document.getElementById(`ui-edit-listening-shortAnswerContainerPart${t}`)?.firstElementChild?.nextElementSibling;for(;s;){const e=s.nextElementSibling;s.parentNode.removeChild(s),s=e}const r=new FormData;r.append("saveChanges",JSON.stringify(i)),await performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),r),NProgress.done(),e.target.disabled=!1,e.target.classList.remove("is-loading"),document.querySelectorAll('input[class^="ui-edit-listening-shortAnswerAnswerPart'+t+'"]').forEach((e=>{e.value=""}));Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Bạn đã thêm câu hỏi mới"})}}else if(e.target&&e.target.className.startsWith("btn btn-outline-primary ui-edit-reading-addNewQuestionPart")){e.preventDefault();const t=e.target.className.match(/\d+/)[0];if("<p><br></p>"==editReadingQuillArray[t-1].root.innerHTML){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn chưa nhập nội dung câu hỏi"})}if(0==document.querySelector("#ui-edit-reading-questionCategorySelectorPart"+t).value){if([...document.querySelectorAll(".ui-edit-reading-multipleChoiceAnswerPart"+t)].some((e=>""===e.value))){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn có một câu trả lời trống"})}e.target.disabled=!0,e.target.classList.add("is-loading"),NProgress.start(),await checkLoginStatus();const n=new Array;document.querySelectorAll('input[class^="ui-edit-reading-multipleChoiceAnswerPart'+t+'"]').forEach((e=>{n.push(e.value)}));const i=[];i.push(parseInt(document.getElementById("ui-edit-reading-correctAnswerSelectPart"+t).value));const o={id:editReadingQuestionCount+=1,question:editReadingQuillArray[t-1].root.innerHTML.trim(),part:t,type:document.getElementById("ui-edit-reading-questionCategorySelectorPart"+t).value,lesson_id:window.location.pathname.split("/").filter(Boolean).pop(),answer:i,options:n};editReadingQuestionsArray.push(o);let a=new String;const s=Array.from({length:26},((e,t)=>String.fromCharCode(65+t)));for(let e=1;e<=n.length;e++)a+=s[e-1]+". "+n[e-1]+"<br>";const r=document.importNode(document.querySelector("#ui-edit-lesson-questionCard").content,!0);r.querySelector('[data-id="question-count"]').textContent="Câu hỏi "+editReadingQuestionCount,r.querySelector('[data-id="question-content"]').innerHTML=editReadingQuillArray[t-1].root.innerHTML+a,r.querySelector('[data-id="div-collapse"]').id=`collapse${editReadingQuestionCount}`,r.querySelector('[data-id="div-collapse"]').innerHTML=n[parseInt(i[0])-1],r.querySelector('[data-id="course-toc"]').id="course-toc-"+editReadingQuestionCount,r.querySelector('[data-id="course-acc"]').setAttribute("data-target","#course-toc-"+editReadingQuestionCount),r.querySelector('[data-id="course-acc"]').setAttribute("data-parent","#ui-edit-listening-accordion-"+editReadingQuestionCount),r.querySelector('[data-id="js-acc"]').id="ui-edit-listening-accordion-"+editReadingQuestionCount,document.querySelector("#ui-edit-reading-questionsContainerPart"+t).appendChild(r),document.getElementById("placeholder_reading_part"+t)&&document.getElementById("placeholder_reading_part"+t).remove(),editReadingQuillArray[t-1].setText("");let l=document.getElementById(`ui-edit-reading-multipleChoiceAnswerContainerPart${t}`)?.firstElementChild?.nextElementSibling;for(;l;){const e=l.nextElementSibling;l.parentNode.removeChild(l),l=e}const d=new FormData;d.append("saveChanges",JSON.stringify(o)),await performSaveDraftReading(window.location.pathname.split("/").filter(Boolean).pop(),d),NProgress.done(),e.target.disabled=!1,e.target.classList.remove("is-loading"),document.querySelector("#ui-edit-reading-correctAnswerSelectPart"+t).querySelectorAll("option").forEach((e=>{"A"!==e.textContent&&document.getElementById("ui-edit-reading-correctAnswerSelectPart"+t).removeChild(e)})),document.querySelectorAll('input[class^="ui-edit-reading-multipleChoiceAnswerPart'+t+'"]').forEach((e=>{e.value=""}));Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Bạn đã thêm câu hỏi mới"})}}})),document.querySelector("#ui-manage-lessons-createArticle").addEventListener("click",(async function(e){e.preventDefault(),await NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("courseId",window.location.pathname.split("/").filter(Boolean).pop()),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/article/initialize",{body:t,method:"POST"});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}await n.json();await loadEditArticlePage(n.lessonId)})),document.querySelector("#ui-edit-article-publishButton").addEventListener("click",(async function(e){e.preventDefault(),e.target.blur(),Swal.fire({title:"Bạn chắc chắn chứ?",text:"Bạn có chắn chắn muốn xuất bản bài giảng này? Bạn luôn có thể chỉnh sửa bài giảng này bất kỳ lúc nào.",icon:"question",showCancelButton:!0,confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Có, tôi chắc chắn",cancelButtonText:"Không, hủy bỏ",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}}).then((async t=>{if(t.isConfirmed){e.target.disabled=!0,e.target.classList.add("is-loading"),safeToExit=!1;const t=new FormData;t.append("articleId",window.location.pathname.split("/").filter(Boolean).pop()),t.append("action","publish"),t.append("csrf_token",csrf_token);await fetch(apiSubdomain+"edit/article/publish",{method:"POST",body:t});safeToExit=!0,Swal.fire({title:"Thành công!",confirmButtonColor:"#5567ff",confirmButtonText:"Đóng",text:"Bạn đã xuất bản bài giảng này. Bạn có thể chỉnh sửa bài giảng này bất kỳ lúc nào.",icon:"success",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}})}}))})),$("#ui-edit-article-addToCourseSelect").on("select2:select",(async function(){const e=$("#ui-edit-article-addToCourseSelect").select2("data"),t=new FormData;t.append("articleCourse",JSON.stringify(e.map((e=>parseInt(e.id,10))))),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/article/sections",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();if("success"===i.message)document.getElementById("ui-edit-article-addToSectionSelect").replaceChildren(),i.section.forEach((e=>{const t=document.importNode(document.querySelector("#ui-select2-option-element").content,!0);t.querySelector('[data-id="option"]').textContent=e.name,t.querySelector('[data-id="option"]').value=e.id,document.querySelector("#ui-edit-article-addToSectionSelect").appendChild(t)}));else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}})),document.querySelector("#ui-edit-article-nameField").addEventListener("input",function(){let e;return async function(){clearTimeout(e),document.getElementById("ui-edit-article-syncStatusText").textContent="Đang lưu bản nháp",e=setTimeout((async()=>{saveChangesEditArticle(window.location.pathname.split("/").filter(Boolean).pop())}),1e3)}}()),document.querySelector("#ui-manage-lessons-createButton").addEventListener("click",(async function(e){e.preventDefault(),await NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"edit/news/initialize",{body:t,method:"POST"});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();await loadEditNewsPage(i.newsId)})),document.addEventListener("keydown",(function(e){if(e.ctrlKey&&"k"===e.key){e.preventDefault();const t=document.getElementById("ui-textArea-searchForm");t&&t.focus()}})),document.querySelector("#ui-edit-account-submit-button").addEventListener("click",(async function(e){e.preventDefault();const t=document.getElementById("a");if(t||0===!t.files.length)try{const e=new FormData;e.append("image",document.getElementById("ui-edit-account-avatarFieldInput").files[0]);const t=await fetch(apiSubdomain+"account/upload",{method:"POST",body:e});if(!t.ok)throw new Error(`Upload failed with status ${t.status}`);return await t.json()}catch(e){throw e}})),document.addEventListener("keyup",(function(e){const t=e.target.parentElement.parentElement;if(!t||!t.id)return;const n=t.id.match(/\d+/);if(n&&n[0])if(e.target&&e.target.classList.contains("ui-edit-listening-multipleChoiceAnswerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0])){if("Enter"===e.key){if(24===document.getElementById("ui-edit-listening-multipleChoiceAnswerContainerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]).childElementCount){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Số câu trả lời đã đạt giới hạn"})}const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.marginTop="1rem";const n=document.createElement("span");n.className="material-icons ui-edit-listening-deleteMultipleChoiceAnswer",n.style.opacity="0.3",n.style.cursor="pointer",n.style.userSelect="none",n.textContent="close";const i=document.createElement("input");i.style.marginLeft="5px",i.type="text",i.className="ui-edit-listening-multipleChoiceAnswerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]+" form-control",i.placeholder="Câu trả lời...",t.appendChild(n),t.appendChild(i);document.querySelector("#ui-edit-listening-multipleChoiceAnswerContainerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]).appendChild(t),i.focus();const o=document.getElementById(`ui-edit-listening-correctAnswerSelectPart${e.target.parentElement.parentElement.id.match(/\d+/)[0]}`),a=o.options[o.options.length-1],s=parseInt(a.value)+1;o.add(new Option(String.fromCharCode(64+s),s))}}else if(e.target&&e.target.classList.contains("ui-edit-reading-multipleChoiceAnswerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0])&&"Enter"===e.key){if(24===document.getElementById("ui-edit-reading-multipleChoiceAnswerContainerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]).childElementCount){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Số câu trả lời đã đạt giới hạn"})}const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.marginTop="1rem";const n=document.createElement("span");n.className="material-icons ui-edit-reading-deleteMultipleChoiceAnswer",n.style.opacity="0.3",n.style.cursor="pointer",n.style.userSelect="none",n.style.fontSize="17px",n.textContent="close";const i=document.createElement("input");i.style.marginLeft="5px",i.style.fontSize=".9rem",i.type="text",i.className="ui-edit-reading-multipleChoiceAnswerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]+" form-control",i.placeholder="Câu trả lời...",t.appendChild(n),t.appendChild(i);document.querySelector("#ui-edit-reading-multipleChoiceAnswerContainerPart"+e.target.parentElement.parentElement.id.match(/\d+/)[0]).appendChild(t),i.focus();const o=document.getElementById(`ui-edit-reading-correctAnswerSelectPart${e.target.parentElement.parentElement.id.match(/\d+/)[0]}`),a=o.options[o.options.length-1],s=parseInt(a.value)+1;o.add(new Option(String.fromCharCode(64+s),s))}})),document.querySelector("#ui-edit-listening-chooseCoverImageFileInput").addEventListener("change",(function(e){const t=e.target.files;if(t.length>0){const e=t[0].name;document.querySelector("#ui-edit-listening-choosenFileName").textContent=e}else document.querySelector("#ui-edit-listening-choosenFileName").textContent="Chưa có hình ảnh"})),document.getElementById("ui-edit-listening-publishButton").addEventListener("click",(async function(){Swal.fire({title:"Bạn chắc chắn chứ?",text:"Bạn có chắn chắn muốn xuất bản bài tập này? Bạn luôn có thể chỉnh sửa bài tập này bất kỳ lúc nào.",icon:"question",showCancelButton:!0,confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Có, tôi chắc chắn",cancelButtonText:"Không, hủy bỏ",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}}).then((async e=>{if(e.isConfirmed){await checkLoginStatus(),NProgress.start();const e=Array(),t=Array.from(document.querySelectorAll('input[id^="ui-edit-listening-chooseAudioFilePart"]')),n=e=>new Promise(((t,n)=>{const i=new FormData;i.append("audioFile",e),i.append("csrf_token",csrf_token);fetch(apiSubdomain+"edit/listening/upload",{method:"POST",body:i}).then((e=>e.json())).then((e=>{t(e.fileURL)})).catch((e=>{n(e)}))}));for(const i of t){const t=i.files[0];if(t)try{const i=await n(t);e.push(i)}catch(e){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Không thể tải lên tệp tin"})}}NProgress.done();const i={saveType:"publish"},o=new FormData;if(o.append("saveSettings",JSON.stringify(i)),o.append("saveChanges",JSON.stringify({})),o.append("lessonAudios",JSON.stringify(e)),o.append("lessonId",window.location.pathname.split("/").filter(Boolean).pop()),o.append("csrf_token",csrf_token),!await fetch(apiSubdomain+"edit/listening/publish",{method:"POST",body:o}).ok){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}Swal.fire({title:"Thành công!",confirmButtonColor:"#5567ff",confirmButtonText:"Đóng",text:"Bạn đã xuất bản bài tập này. Bạn có thể chỉnh sửa bài tập này bất kỳ lúc nào.",icon:"success",customClass:{confirmButton:"swalConformButton",cancelButton:"swalCancelButton"}})}}))})),document.querySelector("#ui-edit-listening-lessonNameTextField").addEventListener("input",(function(e){safeToExit=!1,document.getElementById("ui-edit-listening-syncStatusText").textContent="Đang lưu bản nháp",document.getElementById("ui-edit-listening-syncStatusIcon").textContent="sync",clearTimeout(e.target.dataset.timer),e.target.dataset.timer=setTimeout((()=>{const t=new FormData;t.append("saveChanges",JSON.stringify({})),t.append("lessonName",e.target.value),performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),t)}),1e3)})),document.querySelector("#ui-edit-listening-oneTimeAllowCheckbox").addEventListener("input",function(){let e=null;return function(){clearTimeout(e),document.getElementById("ui-edit-listening-syncStatusText").textContent="Đang lưu bản nháp",document.getElementById("ui-edit-listening-syncStatusIcon").textContent="sync",e=setTimeout((()=>{const e=new FormData;performSaveDraftListening(window.location.pathname.split("/").filter(Boolean).pop(),e)}),1e3)}}()),document.querySelector("#ui-edit-reading-publishButton").addEventListener("click",(function(e){e.preventDefault(),e.target.blur()}));const video=document.getElementById("video");let stream=null,detectionInterval=null,violationCounter=0,noFaceDetectedStartTime=null;const NO_FACE_THRESHOLD_MS=5e3;let shouldEnableProctoring=!1;async function startProctoring(){const e=document.getElementById("overlayCanvas");try{stream=await navigator.mediaDevices.getUserMedia({video:!0}),video.srcObject=stream,video.onloadedmetadata=()=>{e.width=video.videoWidth,e.height=video.videoHeight,detectionInterval=setInterval(detectFace,1)}}catch(e){}}function stopProctoring(){document.getElementById("overlayCanvas");stream&&(stream.getTracks().forEach((e=>e.stop())),video.srcObject=null),detectionInterval&&clearInterval(detectionInterval),noFaceDetectedStartTime=null}async function detectFace(){const e=document.getElementById("overlayCanvas");if(video.paused||video.ended)return;const t=await faceapi.detectAllFaces(video,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks().withFaceExpressions(),n=e.getContext("2d");n.clearRect(0,0,e.width,e.height);const i={width:video.videoWidth,height:video.videoHeight},o=faceapi.resizeResults(t,i);n.drawImage(video,0,0,e.width,e.height),faceapi.draw.drawDetections(e,o),faceapi.draw.drawFaceLandmarks(e,o),faceapi.draw.drawFaceExpressions(e,o),0===o.length?null===noFaceDetectedStartTime?noFaceDetectedStartTime=Date.now():Date.now()-noFaceDetectedStartTime>NO_FACE_THRESHOLD_MS&&!0===shouldEnableProctoring&&(!1===showingCheatingAlert&&Swal.fire({title:"Nhắc nhở",text:"Hãy ngồi ngay ngắn và nhìn thẳng vào màn hình để tiếp tục làm bài.",icon:"warning",showCancelButton:!1,confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Đã hiểu",customClass:{confirmButton:"swalConformButton"}}),showingCheatingAlert=!0,violationCounter++,document.querySelector("#root").style.filter="blur(20px)",sendViolationToBackend("no_face_detected"),noFaceDetectedStartTime=null):(showingCheatingAlert=!1,document.querySelector("#root").style.filter="blur(0px)",noFaceDetectedStartTime=null)}async function sendViolationToBackend(){}async function loadLesson(e){document.querySelector("#ui-lesson-details-submitedOn").style.display="none",document.querySelector("#ui-lesson-details-restartQuiz").style.display="none",document.querySelector("#ui-lesson-details-question-container").style.display="none",document.querySelector("#ui-lesson-details-article-container").style.display="none",document.getElementById("ui-lesson-details-reading-container").style.display="none",NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("lesson_id",e);const n=await fetch(apiSubdomain+"lessons/details",{method:"POST",body:t});if(!n.ok)return void alert("Something went wrong...");const i=await n.json();if(document.getElementById("ui-lesson-details-question-container").style.display="none",document.getElementById("ui-lesson-details-article-container").style.display="none",document.querySelector(".ui-lesson-details-timer").style.display="none",document.querySelector("#ui-lesson-details-comment-root").style.display="none",0===i.informations.skill){if(document.querySelector("#ui-lesson-details-question-container").style.display="block",document.getElementById("ui-lesson-details-question-container").style.display="block",document.querySelector(".ui-lesson-details-timer").style.display="block",!i.success)return void alert("Something went wrong...");const a=new FormData;a.append("lesson_id",e),a.append("course_id",i.informations.courseId[0]),await fetch(apiSubdomain+"recent/update",{method:"POST",body:a}),document.querySelector("#ui-lesson-details-question-container").innerHTML="",lessonQuestionCount=i.questions.length;const s=i.informations.lessonAudios;for(let l=1;l<=s.length;l++){let d=`<audio controls class="ui-lesson-details-audioplayer"><source src="${s[l-1]}" type="audio/mp3" /></audio>`;i.questions.forEach(((t,n)=>{d+=`<div class="border-left-2 page-section pl-32pt"><div class="d-flex align-items-center page-num-container mb-16pt"><div class="page-num">${n+1}</div><h4 id="ui-lesson-details-question${n+1}">${t.question}</h4></div><ul class="list-quiz">`;for(let e=0;e<JSON.parse(t.options).length;e++){const i=Array.from({length:26},((e,t)=>String.fromCharCode(65+t)));d+=`<li class="list-quiz-item" style="cursor: pointer"><span class="list-quiz-badge" id="ui-lesson-details-question${n+1}-option${i[e]}" onclick="selectOptionRadioAction('ui-lesson-details-question${n+1}-option${i[e]}')">${i[e]}</span><span class="list-quiz-text" style="font-size: 1rem" onclick="selectOptionRadioAction('ui-lesson-details-question${n+1}-option${i[e]}')">${JSON.parse(t.options)[e]}</span></li>`}document.getElementById("ui-lesson-details-question-container").insertAdjacentHTML("beforeend",d),d="",n+1===i.questions.length&&document.querySelector("#ui-lesson-details-question-container").insertAdjacentHTML("beforeend",`<button class="btn btn-primary btn-block" style="margin-top: 1rem; margin-bottom: 1rem" onclick="submitLessonAction(this, '${e}')">Nộp bài</button>`)}))}const r=i.informations.lessonSettings;document.getElementById("ui-lesson-details-coursename").textContent=i.informations.courseName,document.getElementById("ui-lesson-details-backtocourse").href="/dashboard/"+localStorage.getItem("currentCourse"),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("lesson-details").forEach((e=>e.style.display="block")),document.querySelectorAll(".ui-lesson-details-authorAvatar").forEach((e=>e.src=i.informations.authorAvatar)),document.querySelectorAll(".ui-lesson-details-authorFullname").forEach((e=>e.textContent=i.informations.authorFullname)),switchPages(),document.querySelector("#ui-lesson-details-timertext").textContent="Thời gian còn lại: "+r.timeLimit+":00",document.title=i.informations.name,NProgress.done(),Audioplayer=new Plyr(".ui-lesson-details-audioplayer"),!0===i.informations.lessonSettings.oneTime?Swal.fire({title:"Lưu ý",text:"Bạn chỉ được phép làm bài tập này một lần duy nhất. Hãy kiểm tra thật kỹ trước khi nộp bài nhé",icon:"warning",confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Đã hiểu",customClass:{confirmButton:"swalConformButton"}}).then((()=>{!0===i.informations.lessonSettings.antiCheat?Swal.fire({title:"Lưu ý",text:"Bạn đang bị giám sát tự động, vui lòng không thoát khỏi chế độ toàn màn hình, chuyển sang cửa sổ khác hoặc rời mắt khỏi màn hình trong lúc làm bài",icon:"warning",confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Đã hiểu",customClass:{confirmButton:"swalConformButton"}}).then((()=>{Swal.fire({title:"Kiểm tra camera của bạn",icon:"info",allowEscapeKey:!1,html:'\n                            <p>Hãy đảm bảo đủ sáng và ngồi ngay ngắn để camera có thể nhận diện được khuôn mặt của bạn</p>\n    <canvas id="overlayCanvas" style="width: 640px; height: 480px;"></canvas>\n  ',showCloseButton:!1,allowOutsideClick:!1,width:700,focusConfirm:!1,confirmButtonText:"\n    Đã sẵng sàng\n  ",customClass:{confirmButton:"swalConformButton"}}).then((()=>{stopProctoring();const e=document.importNode(document.getElementById("proctoringCanvas").content,!0);e.querySelector("[data-id='overlayCanvas']").id="overlayCanvas",document.body.prepend(e),document.documentElement.requestFullscreen(),startProctoring(),shouldEnableProctoring=!0,0!=r.timeLimit?startSmoothTimer(6e4*r.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none"})),startProctoring()})):0!=r.timeLimit?startSmoothTimer(6e4*r.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none"})):0!=r.timeLimit?startSmoothTimer(6e4*r.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none",document.querySelector("#ui-lesson-details-addToFavoriteButton").setAttribute("onclick","addToFavourite(this, '2541032598')")}else if(5===i.informations.skill){const c=new FormData;c.append("postId",e);const u=await fetch(apiSubdomain+"comments/comments",{method:"POST",body:c});if(!u.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const m=await u.json();if("success"!=m.message){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}m.comments.length>0&&m.comments.forEach((()=>{})),document.title=i.informations.articleName,document.getElementById("ui-lesson-details-article-container").style.display="block",document.querySelector("#ui-lesson-details-article-container").innerHTML=i.informations.articlePassages[0],document.querySelector("#ui-lesson-details-timertext").textContent=i.informations.articleName,document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("lesson-details").forEach((e=>e.style.display="block")),switchPages(),NProgress.done()}else if(2===i.informations.skill){if(document.getElementById("ui-lesson-details-reading-container").style.display="block",document.getElementById("ui-lesson-details-reading-container").style.display="block",document.querySelector(".ui-lesson-details-timer").style.display="block",!i.success){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const p=new FormData;p.append("lesson_id",e),p.append("course_id",JSON.parse(i.informations.courseId)[0]),await fetch(apiSubdomain+"recent/update",{method:"POST",body:p}),lessonQuestionCount=i.questions.length;for(let g=0;g<i.informations.lessonPassages.length;g++){const h=document.createElement("div");h.className="row";const y=document.createElement("div");y.className="col-md-6";const f=document.createElement("div");f.className="page-separator";const w=document.createElement("div");w.className="page-separator__text",w.textContent="Bài đọc phần "+[g+1],f.appendChild(w),y.appendChild(f);const S=document.createElement("div");S.id="ui-view-reading-passage-holder-part"+[g+1],S.className="text-70",S.style.fontSize="1rem",S.style.textAlign="justify",S.style.maxHeight="1000px",y.appendChild(S),h.appendChild(y);const v=document.createElement("div");v.className="col-md-6";const b=document.createElement("div");b.className="page-separator";const C=document.createElement("div");C.className="page-separator__text",C.textContent="Câu hỏi phần "+[g+1],b.appendChild(C),v.appendChild(b);const B=document.createElement("div");B.id="ui-view-reading-question-holder-part"+[g+1],B.style.maxHeight="1000px",B.style.overflow="auto",B.style.paddingLeft="20px",B.className="text-70",B.style.fontSize="1rem",v.appendChild(B);const q=document.createElement("button");q.className="btn btn-primary btn-block",q.textContent="Nộp bài",q.style.marginTop="1rem",q.setAttribute("onclick","submitLessonAction(this, '"+e+"')"),v.appendChild(q),h.appendChild(v),document.querySelector("#ui-lesson-details-reading-container").appendChild(h);const E=await new Quill("#ui-view-reading-passage-holder-part"+[g+1],{theme:"bubble",modules:{toolbar:[[{background:[]}]]}});E.clipboard.dangerouslyPasteHTML(i.informations.lessonPassages[g]),document.querySelector("#ui-view-reading-passage-holder-part"+(g+1)).style.setProperty("background-color","transparent","important");E.root.addEventListener("keydown",(e=>{1===e.key.length&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&e.preventDefault()})),E.clipboard.addMatcher(Node.TEXT_NODE,(()=>new Delta)),E.clipboard.addMatcher(Node.ELEMENT_NODE,((e,t)=>t.filter((e=>!e.insert||"string"==typeof e.insert&&""===e.insert.trim()))));for(let x=0;x<i.questions.length;x++){function o(e,t,n){const i=document.createElement("li");i.className="list-quiz-item",i.style.cursor="pointer";const o=document.createElement("span");o.className="list-quiz-badge",o.id=`ui-lesson-details-${e}-option${t}`,o.textContent=t,o.setAttribute("onclick","selectOptionRadioAction('"+o.id+"')");const a=document.createElement("span");return a.className="list-quiz-text",a.style.fontSize="1rem",a.textContent=n,a.onclick=function(){selectOptionRadioAction(o.id)},i.appendChild(o),i.appendChild(a),i}const L=Array.from({length:26},((e,t)=>String.fromCharCode(65+t))),P=document.importNode(document.getElementById("view-questionElement").content,!0);P.querySelector("[data-id='question-name']").innerHTML=i.questions[x].question,P.querySelector("[data-id='question-name']").id="ui-lesson-details-question"+[x+1],P.querySelector("[data-id='page-num']").textContent=[x+1];for(let k=0;k<i.questions[x].options.length;k++)P.querySelector("[data-id='list-quiz']").appendChild(o("question"+[x+1],L[k],i.questions[x].options[k]));document.querySelector("#ui-view-reading-question-holder-part"+[g+1]).appendChild(P)}}!0===i.informations.lessonSettings.oneTime?Swal.fire({title:"Lưu ý",text:"Bạn chỉ được phép làm bài tập này một lần duy nhất. Hãy kiểm tra thật kỹ trước khi nộp bài nhé",icon:"warning",confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Đã hiểu",customClass:{confirmButton:"swalConformButton"}}).then((()=>{!0===i.informations.lessonSettings.antiCheat?Swal.fire({title:"Lưu ý",text:"Bạn đang bị giám sát tự động, vui lòng không thoát khỏi chế độ toàn màn hình, chuyển sang cửa sổ khác hoặc rời mắt khỏi màn hình trong lúc làm bài",icon:"warning",confirmButtonColor:"#5567ff",cancelButtonColor:"#d33",confirmButtonText:"Đã hiểu",customClass:{confirmButton:"swalConformButton"}}).then((()=>{Swal.fire({title:"Kiểm tra camera của bạn",icon:"info",allowEscapeKey:!1,html:'\n                            <p>Hãy đảm bảo đủ sáng và ngồi ngay ngắn để camera có thể nhận diện được khuôn mặt của bạn</p>\n    <canvas id="overlayCanvas" style="width: 640px; height: 480px;"></canvas>\n  ',showCloseButton:!1,allowOutsideClick:!1,width:700,focusConfirm:!1,confirmButtonText:"\n    Đã sẵng sàng\n  ",customClass:{confirmButton:"swalConformButton"}}).then((()=>{stopProctoring();const e=document.importNode(document.getElementById("proctoringCanvas").content,!0);e.querySelector("[data-id='overlayCanvas']").id="overlayCanvas",document.body.prepend(e),document.documentElement.requestFullscreen(),startProctoring(),shouldEnableProctoring=!0,0!=i.informations.lessonSettings.timeLimit?startSmoothTimer(6e4*i.informations.lessonSettings.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none"})),startProctoring()})):0!=i.informations.lessonSettings.timeLimit?startSmoothTimer(6e4*i.informations.lessonSettings.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none"})):0!=i.informations.lessonSettings.timeLimit?startSmoothTimer(6e4*i.informations.lessonSettings.timeLimit):document.querySelector(".ui-lesson-details-timer").style.display="none",document.querySelectorAll(".ui-lesson-details-authorAvatar").forEach((e=>{e.src=i.informations.authorAvatar})),document.querySelectorAll(".ui-lesson-details-authorFullname").forEach((e=>{e.textContent=i.informations.authorFullname})),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("lesson-details").forEach((e=>e.style.display="block")),switchPages(),NProgress.done()}}async function performCreateNewListeningLesson(e,t){e.preventDefault(),NProgress.start(),await checkLoginStatus();const n=new FormData;n.append("csrf_token",csrf_token),n.append("courseId",t);const i=await fetch(apiSubdomain+"edit/listening/initialize",{method:"POST",body:n}),o=await i.json();if(i.ok)if("success"===o.message){window.history.pushState({},"","/edit/"+o.lessonId),document.title="Bài tập chưa có tên",document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("edit-listening").forEach((e=>e.style.display="block"));Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Đã khởi tạo bài tập mới thành công"})}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Không thể khởi tạo bài tập mới"})}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Không thể khởi tạo bài tập mới"})}NProgress.done(),await loadEditListeningPage(o.lessonId)}async function selectOptionRadioAction(e){const t=e.match(/\d+/)[0],n=document.getElementById(e);document.querySelectorAll(`[id^='ui-lesson-details-question${t}-option']`).forEach((e=>{e.classList.remove("bg-primary","text-white"),e.textContent=e.id.match(/[A-Z]/)[0]})),n.innerHTML='<i class="material-icons">check</i>',n.classList.add("bg-primary","text-white")}async function loadDashboard(e){localStorage.setItem("currentCourse",e),NProgress.start(),await checkLoginStatus();const t=new FormData;t.append("id",e),t.append("csrf_token",csrf_token);const n=new FormData;n.append("course_id",e);const i=await fetch(apiSubdomain+"recent/get",{method:"POST",body:n}),o=await i.json();document.querySelector("#ui-dashboard-continueRecentButton").href="/lesson/"+o.informations.lessonId,document.getElementById("ui-dashboard-recentName").textContent=o.informations.lessonName,document.getElementById("ui-dashboard-recentCreatedAt").textContent=o.informations.createdAt,document.querySelector("#ui-dashboard-questionCount").textContent=o.informations.lessonQuestionsCount+" câu hỏi";const a=await fetch(apiSubdomain+"dashboard/dashboard",{method:"POST",body:t});if(a.ok){const t=await a.json();if(document.title=t.informations.name,document.querySelectorAll(".ui-dashboard-coursename").forEach((n=>{n.textContent=t.informations.name,n.href="/dashboard/"+e})),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("dashboard").forEach((e=>e.style.display="block")),document.querySelector("#ui-dashboard-root").replaceChildren(),t.listening.length>0){const e=t.listening.reduce(((e,t)=>(e[t.section_id]||(e[t.section_id]=[]),e[t.section_id].push(t),e)),{});Object.keys(e).forEach((t=>{const n=e[t][0].section_name,i=document.createElement("div");i.className="page-separator";const o=document.createElement("div");o.className="page-separator__text",o.textContent=n,i.appendChild(o),document.querySelector("#ui-dashboard-root").appendChild(i),listeningContainerDiv=document.createElement("div"),listeningContainerDiv.className="row card-group-row",listeningContainerDiv.id="ui-dashboard-container"+t,document.querySelector("#ui-dashboard-root").appendChild(listeningContainerDiv)})),t.listening.forEach((e=>{const t=`<div class="col-lg-3 card-group-row__col">\n                                        <div class="card card-sm card--elevated p-relative o-hidden overlay overlay--primary-dodger-blue js-overlay card-group-row__card" data-toggle="popover" data-trigger="click" data-original-title="" title="" data-domfactory-upgraded="overlay">\n                                            <a href="/lesson/${e.id}" class="card-img-top js-image load" data-position="center" data-height="140" data-domfactory-upgraded="image" style="display: block; position: relative; overflow: hidden; background-image: url(&quot;http://localhost/public/images/paths/flinto_430x168.png&quot;); background-size: cover; background-position: center center; height: 140px;">\n                                                <img src="/public/images/paths/flinto_430x168.png" alt="course" style="visibility: hidden;">\n                                                <span class="overlay__content">\n                                                    <span class="overlay__action d-flex flex-column text-center">\n                                                        <i class="material-icons icon-32pt">play_circle_outline</i>\n                                                        <span class="card-title text-white">Resume</span>\n                                                    </span>\n                                                </span>\n                                            </a>\n\n                                            <div class="card-body flex">\n                                                <div class="d-flex">\n                                                    <div class="flex">\n                                                        <a class="load card-title" href="/lesson/${e.id}">${e.name}</a>\n                                                        <small class="text-50 font-weight-bold mb-4pt">Elijah Murray</small>\n                                                    </div>\n                                                    <a href="javascript:void(0)" class="ml-4pt material-icons text-20 card-course__icon-favorite" onclick="addToFavourite(this, '${e.id}')">favorite_border</a>\n                                                </div>\n                                            </div>\n                                            <div class="card-footer">\n                                                <div class="row justify-content-between">\n                                                    <div class="col-auto d-flex align-items-center">\n                                                        <span class="material-icons icon-16pt text-50 mr-4pt">access_time</span>\n                                                        <p class="flex text-50 lh-1 mb-0"><small>6 hours</small></p>\n                                                    </div>\n                                                    <div class="col-auto d-flex align-items-center">\n                                                        <span class="material-icons icon-16pt text-50 mr-4pt">play_circle_outline</span>\n                                                        <p class="flex text-50 lh-1 mb-0"><small>12 lessons</small></p>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>`;document.querySelector("#ui-dashboard-container"+e.section_id).insertAdjacentHTML("beforeend",t)}))}if(t.article.length>0){const e=t.article.reduce(((e,t)=>(e[t.section_id]||(e[t.section_id]=[]),e[t.section_id].push(t),e)),{});Object.keys(e).forEach((t=>{const n=e[t][0].section_name,i=document.createElement("div");i.className="page-separator";const o=document.createElement("div");o.className="page-separator__text",o.textContent=n,i.appendChild(o),document.querySelector("#ui-dashboard-root").appendChild(i),listeningContainerDiv=document.createElement("div"),listeningContainerDiv.className="row card-group-row",listeningContainerDiv.id="ui-dashboard-container"+t,document.querySelector("#ui-dashboard-root").appendChild(listeningContainerDiv)})),t.article.forEach((e=>{const t=`<div class="col-lg-3 card-group-row__col">\n                                        <div class="card card-sm card--elevated p-relative o-hidden overlay overlay--primary-dodger-blue js-overlay card-group-row__card" data-toggle="popover" data-trigger="click" data-original-title="" title="" data-domfactory-upgraded="overlay">\n                                            <a href="/lesson/${e.id}" class="card-img-top js-image load" data-position="center" data-height="140" data-domfactory-upgraded="image" style="display: block; position: relative; overflow: hidden; background-image: url(&quot;http://localhost/public/images/paths/flinto_430x168.png&quot;); background-size: cover; background-position: center center; height: 140px;">\n                                                <img src="/public/images/paths/flinto_430x168.png" alt="course" style="visibility: hidden;">\n                                                <span class="overlay__content">\n                                                    <span class="overlay__action d-flex flex-column text-center">\n                                                        <i class="material-icons icon-32pt">play_circle_outline</i>\n                                                        <span class="card-title text-white">Resume</span>\n                                                    </span>\n                                                </span>\n                                            </a>\n\n                                            <div class="card-body flex">\n                                                <div class="d-flex">\n                                                    <div class="flex">\n                                                        <a class="load card-title" href="/lesson/${e.id}">${e.name}</a>\n                                                        <small class="text-50 font-weight-bold mb-4pt">Elijah Murray</small>\n                                                    </div>\n                                                    <a href="javascript:void(0)" class="ml-4pt material-icons text-20 card-course__icon-favorite" onclick="addToFavourite(this, '${e.id}')">favorite_border</a>\n                                                </div>\n                                            </div>\n                                            <div class="card-footer">\n                                                <div class="row justify-content-between">\n                                                    <div class="col-auto d-flex align-items-center">\n                                                        <span class="material-icons icon-16pt text-50 mr-4pt">access_time</span>\n                                                        <p class="flex text-50 lh-1 mb-0"><small>6 hours</small></p>\n                                                    </div>\n                                                    <div class="col-auto d-flex align-items-center">\n                                                        <span class="material-icons icon-16pt text-50 mr-4pt">play_circle_outline</span>\n                                                        <p class="flex text-50 lh-1 mb-0"><small>12 lessons</small></p>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>`;document.querySelector("#ui-dashboard-container"+e.section_id).insertAdjacentHTML("beforeend",t)}))}NProgress.done(),await switchPages(),document.getElementById("ui-drawer-mycourses-item").classList.add("open"),document.getElementById("ui-navbar-my_courses-toggler").classList.remove("collapsed"),document.querySelector("#my_courses").classList.add("show"),document.getElementById("ui-navbar-my_courses-toggler").setAttribute("aria-expanded","true");const n=document.getElementById("ui-navbar-mycourse-item-"+e);n&&n.classList.add("active")}}function loadHomePage(){NProgress.start(),checkLoginStatus().then((()=>{fetch(apiSubdomain+"blog/list",{method:"POST"}).then((e=>{e.ok&&e.json().then((e=>{const t=document.getElementById("ui-home-blogs");t&&(t.innerHTML=""),e.data.forEach((e=>{const n=document.importNode(document.getElementById("ui-blog-item").content,!0);n.querySelector('[data-id="blog-image"').src=e.cover_image,n.querySelector('[data-id="blog-name"').textContent=e.name,n.querySelector('[data-id="blog-name"').href="/blog/"+e.id,t.appendChild(n)})),setTimeout((()=>{const e=document.querySelector(".js-mdk-carousel");if(e){const t=e.mdkCarousel;t&&"function"==typeof t.init?t.init():t&&"function"==typeof t._reset&&t._reset()}setTimeout((()=>{document.getElementById("ui-home-blogs").style.transform="translate3d(0px, 0px, 0px)"}),50)}),100),switchPages(),document.title="EngBoost - Học Tiếng Anh cá nhân hóa & luyện thi chứng chỉ",document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("home").forEach((e=>e.style.display="block")),NProgress.done(),document.getElementById("ui-drawer-home-item").classList.add("active"),document.getElementById("ui-login-submit").disabled=!1,document.getElementById("ui-login-submit").classList.remove("is-loading")}))}))}))}async function checkLoginStatus(){try{const e=await fetch(apiSubdomain+"auth/auth",{method:"POST"});if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();if("Authorized"===t.message){(window.location.href.includes("login")||window.location.href.includes("register"))&&(window.history.pushState({},"","/"),loadHomePage()),document.querySelector("#ui-navbar-logged-in").style.display="flex",document.querySelector("#ui-navbar-not-logged-in").style.display="none",csrf_token=t.csrf_token,document.querySelector("#ui-navbar-totalBonus").textContent=t.totalBonus+" điểm",document.getElementById("ui-navbar-avatar").src=t.avatar,document.getElementById("ui-navbar-my_courses-toggler").classList.remove("disabled"),document.getElementById("ui-navbar-useravatar").src="https://cdn.jsdelivr.net/gh/ducanhdang34/storage@main/images/teacher_white.svg",document.querySelector("#ui-navbar-fullname").textContent=t.fullname,await fetch(apiSubdomain+"course/list",{method:"POST"}).then((e=>{e.ok&&(document.getElementById("my_courses").innerHTML="",document.getElementById("ui-navbar-manage-lessons-menu").innerHTML="",e.json().then((e=>{e.forEach((e=>{const t=`<li class="sidebar-menu-item" id="ui-navbar-mycourse-item-${e.id}"><a class="sidebar-menu-button load" href="/dashboard/${e.id}" title="${e.name}"><span class="sidebar-menu-text" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;width: 100%;">${e.name}</span></a></li>`,n=`<li class="sidebar-menu-item" id="ui-navbar-mycourse-item-${e.id}"><a class="sidebar-menu-button load" href="/quizzes/${e.id}" title="${e.name}"><span class="sidebar-menu-text" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;width: 100%;">${e.name}</span></a></li>`;document.querySelector("#my_courses").insertAdjacentHTML("beforeend",t),document.getElementById("ui-navbar-manage-lessons-menu").insertAdjacentHTML("beforeend",n)}))})))}));const e=new FormData;e.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"messages/messages",{method:"POST",body:e});if(n.ok){const e=await n.json();document.querySelector("#ui-navbar-messagesListContainer").innerHTML="",[e.messages].forEach((e=>{const t=document.importNode(document.querySelector("#ui-navbar-message-item").content,!0);null==e.content&&(t.querySelector('[data-id="user-message"]').textContent="Chưa có tin nhắn nào",t.querySelector('[data-id="user-timestamp"]').textContent="Chưa từng trò chuyện",t.querySelector('[data-id="unread-indicator"]').style.display="none"),t.querySelector('[data-id="user-fullname"]').textContent=e.fullname,t.querySelector('[data-id="user-avatar"]').src=e.avatar,t.querySelector('[data-id="user-id"]').setAttribute("onclick","openChatConversation('"+e.id+"')"),document.querySelector("#ui-navbar-messagesListContainer").appendChild(t)}))}return!0}return document.querySelector("#ui-navbar-logged-in").style.display="none",document.querySelector("#ui-navbar-not-logged-in").style.display="flex",document.getElementById("ui-navbar-my_courses-toggler").classList.add("disabled"),document.querySelector("#ui-navbar-fullname").textContent="Chưa Đăng Nhập",document.querySelector("#ui-navbar-useravatar").src="https://cdn.jsdelivr.net/gh/ducanhdang34/storage@main/images/white.svg",(window.location.href.includes("account")||window.location.href.includes("/news/manage/"))&&loadLoginPage(),!1}catch(e){}}async function openChatConversation(e){const t=new FormData;t.append("receiver_id",e),t.append("csrf_token",csrf_token);if((await fetch(apiSubdomain+"messages/conversation",{method:"POST",body:t})).ok)document.querySelector("#conversation-drawer").setAttribute("data-opened",!0),document.querySelector("body").style.overflow="hidden";else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}}async function performCreateNewReadingLesson(e,t){e.preventDefault(),NProgress.start(),await checkLoginStatus();const n=new FormData;n.append("csrf_token",csrf_token),n.append("courseId",t);const i=await fetch(apiSubdomain+"edit/reading/initialize",{method:"POST",body:n}),o=await i.json();if(i.ok)if("success"===o.message){window.history.pushState({},"","/edit/"+o.lessonId),document.title="Bài tập chưa có tên",document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("edit-reading").forEach((e=>e.style.display="block"));Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Đã khởi tạo bài tập mới thành công"})}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Không thể khởi tạo bài tập mới"})}else{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Không thể khởi tạo bài tập mới"})}NProgress.done(),await loadEditReadingPage(o.lessonId)}async function loadManageLessonsPage(e){NProgress.start(),await checkLoginStatus(),document.getElementById("ui-manage-lessons-createListeningButton").setAttribute("onclick","performCreateNewListeningLesson(event, '"+e+"')"),document.getElementById("ui-manage-lessons-createReadingButton").setAttribute("onclick","performCreateNewReadingLesson(event, '"+e+"')");const t=new FormData;t.append("id",e),t.append("csrf_token",csrf_token);const n=await fetch(apiSubdomain+"dashboard/dashboard",{method:"POST",body:t});if(!n.ok){return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Lỗi hệ thống, vui lòng thử lại sau"})}const i=await n.json();document.querySelectorAll(".ui-manage-lessons-courseName").forEach((e=>e.textContent=i.informations.name)),document.title=i.informations.name,document.getElementById("ui-manage-lessons-courseName").href="/quizzes/"+e;const o=i.listening.reduce(((e,t)=>(e[t.section_id]||(e[t.section_id]=[]),e[t.section_id].push(t),e)),{}),a=Object.keys(o);document.getElementById("ui-manage-lessons-quizzesContainer").replaceChildren(),a.forEach((e=>{const t=o[e][0].section_name;document.getElementById("ui-manage-lessons-quizzesContainer").insertAdjacentHTML("beforeend",`<div class="page-separator"><div class="page-separator__text">${t}</div></div><div class="row" id="ui-manage-lessons-container${e}"></div>`)})),i.listening.forEach((e=>{document.getElementById("ui-manage-lessons-container"+e.section_id).insertAdjacentHTML("beforeend",`<div class="card-group-row__col col-lg-3"><div class="card card--elevated card-group-row__card card-sm js-overlay o-hidden overlay overlay--primary-dodger-blue p-relative"data-domfactory-upgraded=overlay data-original-title=""data-toggle=popover data-trigger=click><a class="load card-img-top js-image"href=/lesson/${e.id} data-domfactory-upgraded=image data-height=140 data-position=center style="display:block;position:relative;overflow:hidden;background-image:url('${e.settings.coverImage}');background-size:cover;background-position:center center;height:140px"><span class="overlay__content"><span class="overlay__action d-flex flex-column text-center"></span></span></a><div class="flex card-body"><div class=d-flex><div class=flex><a class="load card-title"href=/lesson/${e.id}>${e.name}</a> <small class="text-50 font-weight-bold mb-4pt">Elijah Murray</small></div><a class="load material-icons card-course__icon-favorite ml-4pt text-20"href="/edit/${e.id}">edit</a></div></div><div class=card-footer><div class="justify-content-between row"><div class="d-flex align-items-center col-auto"><span class="text-50 icon-16pt material-icons mr-4pt">access_time</span><p class="text-50 flex lh-1 mb-0"><small>6 hours</small></div><div class="d-flex align-items-center col-auto"><span class="text-50 icon-16pt material-icons mr-4pt">play_circle_outline</span><p class="text-50 flex lh-1 mb-0"><small>12 lessons</small></div></div></div></div></div>`)})),switchPages(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("manage-quizzes").forEach((e=>e.style.display="block")),NProgress.done(),document.getElementById("ui-drawer-manageLessons-item").classList.add("open"),document.getElementById("ui-navbar-manage-lessons-toggler").classList.remove("collapsed"),document.querySelector("#ui-navbar-manage-lessons-menu").classList.add("show"),document.getElementById("ui-navbar-manage-lessons-toggler").setAttribute("aria-expanded","true")}async function switchPages(){return new Promise((e=>{clearInterval(timer);let t=document.querySelector(".ui-lesson-details-timer");t.style.transition="none",t.style.width="100%",window.scrollTo(0,0);const n=document.querySelector(".preloader");let i=1;!function t(){i-=.05,i<=0?(n.style.display="none",n.style.opacity=1,e()):(n.style.opacity=i,requestAnimationFrame(t))}(),document.getElementById("ui-drawer-home-item").classList.remove("active"),document.querySelector("#ui-login-username").value="",document.querySelector("#ui-login-username").classList.remove("is-invalid"),document.querySelector("#ui-login-invalid-username").style.display="none",document.getElementById("ui-login-password").value="",document.getElementById("ui-login-password").classList.remove("is-invalid"),document.querySelector("#ui-login-invalid-password").style.display="none",window.location.href.includes("/dashboard/")||(document.getElementById("ui-drawer-mycourses-item").classList.remove("open"),document.getElementById("ui-navbar-my_courses-toggler").classList.add("collapsed"),document.querySelector("#my_courses").classList.remove("show"),document.getElementById("ui-navbar-my_courses-toggler").setAttribute("aria-expanded","false"));try{Audioplayer.destroy()}catch(e){}}))}function loadLoginPage(){NProgress.start(),checkLoginStatus().then((e=>{if(switchPages(),e)return loadHomePage(),void window.history.pushState({},"","/");document.title="Đăng nhập",document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("login").forEach((e=>e.style.display="block")),NProgress.done()}))}async function loadRegisterPage(){NProgress.start(),document.title="Đăng ký",await checkLoginStatus(),switchPages(),document.querySelectorAll("#root > *:not(.doNotHide)").forEach((e=>e.style.display="none")),document.querySelectorAll("register").forEach((e=>e.style.display="block")),NProgress.done()}Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri("https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights"),faceapi.nets.faceLandmark68Net.loadFromUri("https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights"),faceapi.nets.faceRecognitionNet.loadFromUri("https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights"),faceapi.nets.faceExpressionNet.loadFromUri("https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights")]).catch((()=>{})),document.getElementById("ui-login-form").addEventListener("submit",(async function(e){e.preventDefault(),document.getElementById("ui-login-submit").disabled=!0,document.getElementById("ui-login-submit").classList.add("is-loading"),await grecaptcha.ready((function(){grecaptcha.execute("6LfsmHMrAAAAABqKOdIt1mVQpBNmxRVwdYmPvRXR",{action:"submit_form"}).then((function(e){const t=new FormData;t.append("username",document.getElementById("ui-login-username").value),t.append("password",document.getElementById("ui-login-password").value),t.append("g-recaptcha-response",e),fetch(apiSubdomain+"auth/login",{method:"POST",body:t}).then((e=>{e.ok&&e.json().then((async e=>{if("failed"===e.message)document.querySelector("#ui-login-invalid-username").textContent="Sai thông tin đăng nhập",document.querySelector("#ui-login-invalid-username").style.display="block",document.querySelector("#ui-login-username").classList.add("is-invalid"),document.querySelector("#ui-login-username").classList.remove("is-valid"),document.querySelector("#ui-login-invalid-password").textContent="Sai thông tin đăng nhập",document.querySelector("#ui-login-invalid-password").style.display="block",document.querySelector("#ui-login-password").classList.add("is-invalid"),document.querySelector("#ui-login-password").classList.remove("is-valid"),document.getElementById("ui-login-submit").disabled=!1,document.getElementById("ui-login-submit").classList.remove("is-loading");else{await NProgress.start(),loadHomePage(),window.history.pushState({},"","/");Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Đăng nhập thành công"})}}))}))}))}))})),document.getElementById("ui-register-form").addEventListener("submit",(function(e){if(e.preventDefault(),document.querySelector("#terms").classList.remove("is-invalid"),!document.querySelector("#terms").checked){document.querySelector("#terms").classList.add("is-invalid");return void Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"error",title:"Bạn chưa đồng ý các điều khoản"})}document.getElementById("ui-register-submit").disabled=!0;const t=new FormData;t.append("fullname",document.getElementById("ui-register-fullname").value),t.append("username",document.getElementById("ui-register-username").value),t.append("email",document.getElementById("ui-register-email").value),t.append("phone",document.getElementById("ui-register-phone").value),t.append("password",document.getElementById("ui-register-password").value),t.append("password_confirm",document.getElementById("ui-register-confirm-password").value),fetch(apiSubdomain+"auth/register",{method:"POST",body:t}).then((e=>{e.ok&&e.json().then((e=>{if(document.getElementById("ui-register-submit").disabled=!1,"success"===e.message){loadLoginPage(),window.history.pushState({},"","/login");Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}}).fire({icon:"success",title:"Đăng ký thành công"})}else""!==e.fullname_err?(document.getElementById("ui-register-fullname").classList.add("is-invalid"),document.getElementById("ui-register-fullname-invalid").textContent=e.fullname_err,document.getElementById("ui-register-fullname-invalid").style.display="block"):(document.getElementById("ui-register-fullname-invalid").style.display="none",document.getElementById("ui-register-fullname").classList.add("is-valid"),document.getElementById("ui-register-fullname").classList.remove("is-invalid")),""!==e.username_err?(document.getElementById("ui-register-username").classList.add("is-invalid"),document.getElementById("ui-register-username-invalid").textContent=e.username_err,document.getElementById("ui-register-username-invalid").style.display="block"):(document.getElementById("ui-register-username-invalid").style.display="none",document.getElementById("ui-register-username").classList.add("is-valid"),document.getElementById("ui-register-username").classList.remove("is-invalid")),""!==e.email_err?(document.getElementById("ui-register-email").classList.add("is-invalid"),document.getElementById("ui-register-email-invalid").textContent=e.email_err,document.getElementById("ui-register-email-invalid").style.display="block"):(document.getElementById("ui-register-email-invalid").style.display="none",document.getElementById("ui-register-email").classList.add("is-valid"),document.getElementById("ui-register-email").classList.remove("is-invalid")),""!==e.phone_err?(document.getElementById("ui-register-phone").classList.add("is-invalid"),document.getElementById("ui-register-phone-invalid").textContent=e.phone_err,document.getElementById("ui-register-phone-invalid").style.display="block"):(document.getElementById("ui-register-phone-invalid").style.display="none",document.getElementById("ui-register-phone").classList.add("is-valid"),document.getElementById("ui-register-phone").classList.remove("is-invalid")),""!==e.password_err?(document.getElementById("ui-register-password").classList.add("is-invalid"),document.getElementById("ui-register-password-invalid").textContent=e.password_err,document.getElementById("ui-register-password-invalid").style.display="block"):(document.getElementById("ui-register-password-invalid").style.display="none",document.getElementById("ui-register-password").classList.add("is-valid"),document.getElementById("ui-register-password").classList.remove("is-invalid")),""!==e.confirm_err?(document.getElementById("ui-register-confirm-password").classList.add("is-invalid"),document.getElementById("ui-register-confirm-invalid").textContent=e.confirm_err,document.getElementById("ui-register-confirm-invalid").style.display="block"):(document.getElementById("ui-register-confirm-invalid").style.display="none",document.getElementById("ui-register-confirm-password").classList.add("is-valid"),document.getElementById("ui-register-confirm-password").classList.remove("is-invalid"))}))}))}));